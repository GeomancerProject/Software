# Configuration for bulkloding Record and RecordIndex to App Engine datastore.

python_preamble:
- import: base64
- import: re
- import: google.appengine.ext.bulkload.transform
- import: google.appengine.ext.bulkload.bulkloader_wizard
- import: google.appengine.ext.db
- import: google.appengine.api.datastore
- import: google.appengine.api.users
- import: bulkload_helper
- import: ndb

transformers:

- kind: Feature
  connector: csv
  connector_options:
    encoding: utf_8
  
  property_map:
    - property: __key__
      external_name: id
      export_transform: transform.key_id_or_name_as_string
    
    - property: n #name
      external_name: name
      import_transform: transform.none_if_empty(str)

    - property: c #category
      external_name: type
      import_transform: transform.none_if_empty(str)

    - property: j #json
      external_name: id
      import_transform: bulkload_helper.get_feature_json()

  #post_import_function: bulkload_helper.ignore_if_deleted    
      
- kind: FeatureIndex
  connector: csv
  connector_options:
    encoding: utf_8
  
  property_map:
    - property: __key__
      external_name: id
      import_transform: bulkload_helper.create_feature_index_key()
                
    - property: c #category
      external_name: type
      import_transform: "lambda x: x.lower()"

    - property: s #source
      external_name: source
      import_transform: "lambda x: x.lower()"
             
    - property: k #keywords
      external_name: name
      import_transform: bulkload_helper.get_keywords()

  #post_import_function: bulkload_helper.add_dynamic_properties    